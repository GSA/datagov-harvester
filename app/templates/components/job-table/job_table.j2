{% macro job_table(jobs, caption, show_source=true) -%}
<div class="usa-table-container--scrollable" tabindex="0">
    <table class="usa-table usa-table--striped usa-table--sortable" data-sortable>
        <caption>{{ caption }}</caption>
        <thead>
            <tr>
                <th scope="col">Job Id</th>
                <th scope="col" data-sortable>Type</th>
                {% if show_source %}
                <th scope="col" data-sortable>
                        Source
                    </th>
                {% endif %}
                <th scope="col" data-sortable>Status</th>
                <th scope="col" data-sortable>Created</th>
                <th scope="col" data-sortable>Date Finished</th>
                <th scope="col" data-sortable>Records Added</th>
                <th scope="col" data-sortable>Records Updated</th>
                <th scope="col" data-sortable>Records Deleted</th>
                <th scope="col" data-sortable>Records Errored</th>
                <th scope="col" data-sortable>Records Ignored</th>
            </tr>
        </thead>
        <tbody id="paginated_harvest_jobs">
            {% for job in jobs %}
            <tr>
                <td data-sort-value="{{ job.id }}">
                    <a href="{{ url_for('main.view_harvest_job', job_id=job.id) }}">
                        {{ job.id[:8] }}...
                    </a>
                </td>
                <td data-sort-value="{{ job.job_type }}">{{ job.job_type }}</td>
                {% if show_source %}
                <td data-sort-value="{{ job.source.name }}">
                    <a href="{{ url_for('main.view_harvest_source', source_id=job.source.id) }}">
                        {{ job.source.name }}
                    </a>
                </td>
                {% endif %}
                <td data-sort-value="{{ job.status }}">
                    <span class="usa-tag {% if job.status == 'error' %}usa-tag--error
                                        {% elif job.status == 'in_progress' %}usa-tag--warning
                                        {% elif job.status == 'complete' %}usa-tag--success
                                        {% else %}usa-tag--base{% endif %}">
                        {{ job.status }}
                    </span>
                </td>
                <td data-sort-value="{{ job.date_created.isoformat() if job.date_created else '' }}">
                    {{ job.date_created.strftime('%Y-%m-%d %H:%M:%S') if job.date_created else 'N/A' }}
                </td>
                <td data-sort-value="{{ job.date_finished.isoformat() if job.date_finished else 'zzzz' }}">
                    {{ job.date_finished.strftime('%Y-%m-%d %H:%M:%S') if job.date_finished else 'N/A' }}
                </td>
                <td data-sort-value="{{ job.records_added or 0 }}">{{ job.records_added or 0 }}</td>
                <td data-sort-value="{{ job.records_updated or 0 }}">{{ job.records_updated or 0 }}</td>
                <td data-sort-value="{{ job.records_deleted or 0 }}">{{ job.records_deleted or 0 }}</td>
                <td data-sort-value="{{ job.records_errored or 0 }}">{{ job.records_errored or 0 }}</td>
                <td data-sort-value="{{ job.records_ignored or 0 }}">{{ job.records_ignored or 0 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="usa-sr-only usa-table__announcement-region" aria-live="polite"></div>
</div>
{%- endmacro %}
